# Tablespace, Schema and Table Migration Use Cases

## Introduction

This is the third of four labs that are part of the Oracle Public Cloud Database Cloud Service workshop. 

In this lab, you will explore some common use cases for moving sub-sets of your data from on-premises to the cloud. There are multiple options for solving this data movement challenge. In this lab, we will migrate databases, tablespaces, schemas, and individual tables. You will be migrating data from the source database to the target database, and will use standard Oracle Data Pump tools to perform these migrations.   These are only a few of the many options for moving data into and between Oracle databases.  More choices for how to migrate Oracle Databases from on-premise to the cloud can be found in this [Migration Strategies Document](http://www.oracle.com/technetwork/database/database-appliance/documentation/oda-migration-strategies-1676870.pdf).

***Note: All the steps in this lab will be done using ssh, bash commands, and sqlplus.***

This lab supports the following use cases:
-	Migration of tablespaces using physical file copy.
-	Logical migration of databases and data schemas using data pump.
-	Use of database links to selectively copy tables from source to target.

To log issues and view the Lab Guide source, go to the [github oracle](https://github.com/oracle/learning-library/tree/master/workshops/dbcs-dba-oci) repository.

## Objectives

-   Hot clone a pluggable database from on-premise to the Cloud.
-   Migrate a schema using Oracle Data Pump.
-   Migrate data using a Transportable Tablespace.
-   Copy data using Database Links.

## Required Artifacts

-   You must have successfully completed lab 1.  Completion of lab 2 is not required.

## Task 1:  Migrate data using transportable tablespaces.

While datapump provides a very fast multi-threaded technique to move data quickly between Oracle Databases, it was not designed for very large volumes of data. Transportable Tablespaces enable a database file copy technique that does not require an exported copy of the data, but instead allow you to copy the in-place data files to target, which using Datapump to capture the metadata only. 

- SSH into the source `workshop1_db` database and create the user and tablespace `alpha_archive`.
```
<copy>sudo su - oracle  
sqlplus system/&lt;password&gt;@pdb1;
create tablespace alpha_archive datafile '+data';
create user alpha_archive identified by &lt;password&gt; default tablespace alpha_archive;
grant dba to alpha_archive;</copy>
```

- Copy and paste this:
```
<copy>begin
for i in (select table_name from all_tables where owner = 'ALPHA')
loop
execute immediate 'create table alpha_archive.'||i.table_name||' as select * from alpha.'||i.table_name;
end loop;
end;
/</copy>
```

- Confirm the user, tablespace, and data was created correctly.
```
<copy>connect alpha_archive/&lt;password&gt;@pdb1;
col table_name format a30
col tablespace_name format a30
set pagesize 0
select table_name, tablespace_name from user_tables;</copy>

SQL> /
ADDRESSES		       	ALPHA_ARCHIVE  
ADDRESS_USAGES		     ALPHA_ARCHIVE  
ALPHA_SERVICES_STATS	ALPHA_ARCHIVE  
COUNTRY_CODES		     ALPHA_ARCHIVE  
COUPON_USAGES		     ALPHA_ARCHIVE  
CUSTOMERS		       	ALPHA_ARCHIVE  
CUSTOMER_IDENTIFICATIONS ALPHA_ARCHIVE  
CUSTOMER_INTERESTS	     ALPHA_ARCHIVE  
DISCOUNTS		          ALPHA_ARCHIVE  
LOOKUP_CODES		     ALPHA_ARCHIVE
ORDERS			     ALPHA_ARCHIVE
ORDER_ITEMS		     ALPHA_ARCHIVE
PAYMENT_OPTIONS 	     ALPHA_ARCHIVE
PRODUCTS		          ALPHA_ARCHIVE
PRODUCT_CATEGORIES	     ALPHA_ARCHIVE
PRODUCT_IMAGES		     ALPHA_ARCHIVE
PRODUCT_STOCK_LEVELS	ALPHA_ARCHIVE
SALES_ORDER_HEADER	     ALPHA_ARCHIVE
SALES_ORDER_LINE_ITEM	ALPHA_ARCHIVE
```

- Set the tablespace to be migrated in read only.
```
<copy>alter tablespace alpha_archive read only;</copy>
Tablespace altered.
```

- Export the `alpha_archive` metadata.
```
create directory tmp as '/tmp';
grant all on directory tmp to public;

exit -- from sqlplus

expdp system/&lt;password&gt;@pdb1 directory=tmp dumpfile=alpha_archive_tbs.dmp transport_tablespaces=alpha_archive exclude=statistics encryption_password=&lt;password&gt; logfile=full_tts_export.log</copy>

[oracle@workshop1 tmp]$ expdp system/&lt;password&gt;@pdb1 directory=tmp dumpfile=alpha_archive_tbs.dmp transport_tablespaces=alpha_archive exclude=statistics encryption_password=&lt;password&gt; logfile=full_tts_export.log

Export: Release 19.0.0.0.0 - Production on Wed Jan 29 22:30:01 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

Connected to: Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Starting "SYSTEM"."SYS_EXPORT_TRANSPORTABLE_01":  system/********@pdb1 directory=tmp dumpfile=alpha_archive_tbs.dmp transport_tablespaces=alpha_archive exclude=statistics encryption_password=******** logfile=full_tts_export.log 
Processing object type TRANSPORTABLE_EXPORT/PLUGTS_BLK
Processing object type TRANSPORTABLE_EXPORT/POST_INSTANCE/PLUGTS_BLK
Processing object type TRANSPORTABLE_EXPORT/TABLE
Master table "SYSTEM"."SYS_EXPORT_TRANSPORTABLE_01" successfully loaded/unloaded
******************************************************************************
Dump file set for SYSTEM.SYS_EXPORT_TRANSPORTABLE_01 is:
  /tmp/alpha_archive_tbs.dmp
******************************************************************************
Datafiles required for transportable tablespace ALPHA_ARCHIVE:
  +DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive.276.1031003683
Job "SYSTEM"."SYS_EXPORT_TRANSPORTABLE_01" successfully completed at Wed Jan 29 22:30:47 2020 elapsed 0 00:00:44
```

- Change the permissions on the export file so user opc can copy to the target database.
```
<copy>chmod a+r /tmp/alpha_archive_tbs.dmp

exit -- from user oracle</copy>
```

- Copy the metadata (dmp file) to the target database using the opc user.
```
<copy>scp -i ~/id_rsa /tmp/alpha_archive_tbs.dmp opc@&lt;target db IP&gt;:/tmp</copy>
[opc@workshop1 ~]$ scp -i ~/id_rsa /tmp/alpha_archive_tbs.dmp opc@129.146.123.48:/tmp
alpha_archive_tbs.dmp                         100%  652KB  67.9MB/s   00:00 
```

- At this point we have only exported the metadata (table definitions - not the data itself).  Next locate and review the `alpha_archive` datafiles.
```
<copy>sudo su - oracle
sqlplus system/&lt;password&gt;@pdb1
set linesize 100
col tablespace_name format a15
col file_name format a60
select tablespace_name, file_name from dba_data_files;</copy>

TABLESPACE_NAME FILE_NAME
--------------- ------------------------------------------------------------
SYSTEM	 	+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/system.271.1029871741
SYSAUX	 	+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/sysaux.272.1029871741
UNDOTBS1	+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/undotbs1.270.1029871741
USERS		+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/users.275.1029872131
ALPHA_ARCHIVE	+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive.276.1031003683
```

```
<copy>exit -- from sqlplus</copy>
```

- Now we know where the data files are in Automatic Storage Management (ASM) we need to use `asmcmd` to copy the data out of the file manager to tmp before copying to the target database.  ***Note: your file names will be different - take note and use those names/versions***.
```
<copy>asmcmd -a sysdba
cp +DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive.276.1031003683 /tmp</copy>
copying +DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive.276.1031003683 -> /tmp/alpha_archive.276.1031003683
```

```
<copy>exit -- out of asmcmd
exit -- out of oracle</copy>
```

- Now we have the data copied to tmp we need to copy it to the target database.  First change the permissions so opc user can read the data, and then scp/copy the data.
```
<copy>sudo chmod a+r /tmp/alpha_archive.276.1031003683

scp -i ~/id_rsa /tmp/alpha_archive.276.1031003683 opc@&lt;target db IP&gt;:/tmp</copy>
alpha_archive.276.1031003683                              100%  100MB  94.0MB/s   00:01    
```

```
<copy>exit -- out of workshop1_db</copy>
```

- All of the above was done on the source database VM.  The remainder will be done on the target database.  SSH into the target database VM and change file permissions so user oracle can import/copy the data and metadata. 
```
<copy>sudo chown oracle /tmp/alpha*</copy>
```

- Review the data files.  Since in lab 2 you cloned the source database the ASM files will be exactly the same.  Normally they would not be, and you would need to review the files to identify the directories to where you will copy the data files.
```
<copy>sudo su - oracle
sqlplus system/&lt;password&gt;@pdb1
set linesize 100
col tablespace_name format a15
col file_name format a60
select tablespace_name, file_name from dba_data_files;</copy>

TABLESPACE_NAME FILE_NAME
--------------- ------------------------------------------------------------
SYSTEM		+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/system.271.1029871741
SYSAUX		+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/sysaux.272.1029871741
UNDOTBS1	+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/undotbs1.270.1029871741
USERS		+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/users.275.1029872131
```

```
<copy>exit -- from sqlplus</copy>
```

- Next copy the data file to the target ASM directory.  Again use asmcmd to do that.
```
<copy>asmcmd -a sysdba
cp /tmp/alpha_archive.276.1031003683 +DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive</copy>
copying /tmp/alpha_archive.276.1031003683 -> +DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive
```

- Review/confirm the file was copied.
```
<copy>ls +DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE</copy>
ASMCMD> ls +DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE
SYSAUX.272.1029871741
SYSTEM.271.1029871741
UNDOTBS1.270.1029871741
USERS.275.1029872131
alpha_archive
```

```
<copy>exit -- from asmcmd</copy>
```

- Now create user alpha_archive and directory tmp.
```
<copy>sqlplus system/&lt;password&gt;@pdb1

create user alpha_archive identified by &lt;password&gt;;</copy>
User created.
```

```
<copy>grant dba to alpha_archive;</copy>
Grant succeeded.
```

```
<copy>create directory tmp as '/tmp'; -- this may already exist

exit -- from sqlplus</copy>
```

- Now import the metadata (table definitions).
```
<copy>impdp system/&lt;password&gt;@pdb1 directory=tmp dumpfile=alpha_archive_tbs.dmp logfile=full_tts_imp.log encryption_password=&lt;password&gt; transport_datafiles=+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive</copy>

[oracle@workshop1 ~]$ impdp system/&lt;password&gt;@pdb1 directory=tmp dumpfile=alpha_archive_tbs.dmp logfile=full_tts_imp.log encryption_password=&lt;password&gt; transport_datafiles=+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive

Import: Release 19.0.0.0.0 - Production on Wed Jan 29 23:27:37 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

Connected to: Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Master table "SYSTEM"."SYS_IMPORT_TRANSPORTABLE_01" successfully loaded/unloaded
Starting "SYSTEM"."SYS_IMPORT_TRANSPORTABLE_01":  system/********@pdb1 directory=tmp dumpfile=alpha_archive_tbs.dmp logfile=full_tts_imp.log encryption_password=******** transport_datafiles=+DATA/ORCL_PHX273/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive 
Processing object type TRANSPORTABLE_EXPORT/PLUGTS_BLK
Processing object type TRANSPORTABLE_EXPORT/TABLE
Processing object type TRANSPORTABLE_EXPORT/POST_INSTANCE/PLUGTS_BLK
Job "SYSTEM"."SYS_IMPORT_TRANSPORTABLE_01" successfully completed at Wed Jan 29 23:27:55 2020 elapsed 0 00:00:17
```

- Log into user `alpha_archive` and confirm the data was migrated successfully.
```
<copy>sqlplus alpha_archive/&lt;password&gt;@pdb1</copy>

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Jan 29 23:28:46 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Connected to:
Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Version 19.5.0.0.0
```

```
<copy>select table_name from user_tables;</copy>

TABLE_NAME
---------------------------------------------------
PRODUCT_STOCK_LEVELS
DISCOUNTS
ALPHA_SERVICES_STATS
ADDRESS_USAGES
COUNTRY_CODES
ORDER_ITEMS
PRODUCTS
ORDERS
CUSTOMER_IDENTIFICATIONS
CUSTOMER_INTERESTS
PAYMENT_OPTIONS
SALES_ORDER_HEADER
LOOKUP_CODES
ADDRESSES
CUSTOMERS
PRODUCT_CATEGORIES
COUPON_USAGES
SALES_ORDER_LINE_ITEM
PRODUCT_IMAGES

19 rows selected.
```

## Task 2:  Migrate data in a pdb using data pump.

Data pump supports a variety of use cases for moving data from one database to another.  You can migrate entire databases (this lab), schemas, or individual tables, and because you are exporting the data out of the source database rather that copying the database files themselves, you don't need to perform encryption wallet commands.  While it is slower that tablespace migration (above) where we copied the tablespace files directly rather than performing an export operation, it uses parallel operations on multiple processors and can compress and encrypt the data.  DBMS_CLOUD in Autonomous Database also supports datapump, and data pump is the most popular ways of moving data when you don't want to migrate an entire database.

- To perform a full export, you must have the **DATAPUMP_EXP\_FULL\_DATABASE** role. We are using the system user which already has this privilege.  Log into your source database, switch to the oracle user and run the export command.  This will write a dmp file to the /tmp directory.  Note we already created the oracle tmp directory in previous steps above.  We are choosing a full database export, and compressing and encrypting the data.
```
<copy>sudo su - oracle
expdp system/&lt;password&gt;@pdb1 directory=tmp dumpfile=source_pdb1.dmp compression=all logfile=source_pdb1_export.log full=yes encryption=all encryption_mode=password encryption_password=&lt;password&gt; encryption_algorithm=aes256</copy>

[oracle@workshop1 ~]$ expdp system/&lt;password&gt;@pdb1 directory=tmp dumpfile=source_pdb1.dmp compression=all logfile=source_pdb1_export.log full=yes encryption=all encryption_mode=password encryption_password=&lt;password&gt; encryption_algorithm=aes256

Export: Release 19.0.0.0.0 - Production on Thu Jan 30 18:44:32 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

Connected to: Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Starting "SYSTEM"."SYS_EXPORT_FULL_01":  system/********@pdb1 directory=tmp dumpfile=source_pdb1.dmp compression=all logfile=source_pdb1_export.log full=yes encryption=all encryption_mode=password encryption_password=******** encryption_algorithm=aes256 
Processing object type DATABASE_EXPORT/EARLY_OPTIONS/VIEWS_AS_TABLES/TABLE_DATA
Processing object type DATABASE_EXPORT/NORMAL_OPTIONS/TABLE_DATA
Processing object type DATABASE_EXPORT/NORMAL_OPTIONS/VIEWS_AS_TABLES/TABLE_DATA
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/TABLE_DATA
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/INDEX/STATISTICS/INDEX_STATISTICS
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/STATISTICS/TABLE_STATISTICS
Processing object type DATABASE_EXPORT/STATISTICS/MARKER
Processing object type DATABASE_EXPORT/PRE_SYSTEM_IMPCALLOUT/MARKER
Processing object type DATABASE_EXPORT/PRE_INSTANCE_IMPCALLOUT/MARKER
Processing object type DATABASE_EXPORT/TABLESPACE
Processing object type DATABASE_EXPORT/PROFILE
Processing object type DATABASE_EXPORT/SCHEMA/USER
Processing object type DATABASE_EXPORT/RADM_FPTM
Processing object type DATABASE_EXPORT/GRANT/SYSTEM_GRANT/PROC_SYSTEM_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/GRANT/SYSTEM_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/ROLE_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/DEFAULT_ROLE
Processing object type DATABASE_EXPORT/SCHEMA/ON_USER_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/TABLESPACE_QUOTA
Processing object type DATABASE_EXPORT/RESOURCE_COST
Processing object type DATABASE_EXPORT/TRUSTED_DB_LINK
Processing object type DATABASE_EXPORT/SCHEMA/SEQUENCE/SEQUENCE
Processing object type DATABASE_EXPORT/DIRECTORY/DIRECTORY
Processing object type DATABASE_EXPORT/DIRECTORY/GRANT/OWNER_GRANT/OBJECT_GRANT
Processing object type DATABASE_EXPORT/SYSTEM_PROCOBJACT/PRE_SYSTEM_ACTIONS/PROCACT_SYSTEM
Processing object type DATABASE_EXPORT/SYSTEM_PROCOBJACT/PROCOBJ
Processing object type DATABASE_EXPORT/SYSTEM_PROCOBJACT/POST_SYSTEM_ACTIONS/PROCACT_SYSTEM
Processing object type DATABASE_EXPORT/SCHEMA/PROCACT_SCHEMA
Processing object type DATABASE_EXPORT/EARLY_OPTIONS/VIEWS_AS_TABLES/TABLE
Processing object type DATABASE_EXPORT/EARLY_POST_INSTANCE_IMPCALLOUT/MARKER
Processing object type DATABASE_EXPORT/NORMAL_OPTIONS/TABLE
Processing object type DATABASE_EXPORT/NORMAL_OPTIONS/VIEWS_AS_TABLES/TABLE
Processing object type DATABASE_EXPORT/NORMAL_POST_INSTANCE_IMPCALLOUT/MARKER
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/TABLE
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/COMMENT
Processing object type DATABASE_EXPORT/SCHEMA/FUNCTION/FUNCTION
Processing object type DATABASE_EXPORT/SCHEMA/PROCEDURE/PROCEDURE
Processing object type DATABASE_EXPORT/SCHEMA/FUNCTION/ALTER_FUNCTION
Processing object type DATABASE_EXPORT/SCHEMA/PROCEDURE/ALTER_PROCEDURE
Processing object type DATABASE_EXPORT/SCHEMA/VIEW/VIEW
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/INDEX/INDEX
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/CONSTRAINT/CONSTRAINT
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/CONSTRAINT/REF_CONSTRAINT
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/TRIGGER
Processing object type DATABASE_EXPORT/FINAL_POST_INSTANCE_IMPCALLOUT/MARKER
Processing object type DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCACT_SCHEMA
Processing object type DATABASE_EXPORT/SCHEMA/PASSWORD_HISTORY
Processing object type DATABASE_EXPORT/AUDIT_UNIFIED/AUDIT_POLICY_ENABLE
Processing object type DATABASE_EXPORT/POST_SYSTEM_IMPCALLOUT/MARKER
. . exported "SYS"."KU$_USER_MAPPING_VIEW"               5.273 KB      38 rows
. . exported "AUDSYS"."AUD$UNIFIED":"SYS_P201"           197.0 KB    2848 rows
. . exported "AUDSYS"."AUD$UNIFIED":"SYS_P261"           63.51 KB     398 rows
. . exported "SYSTEM"."REDO_DB"                           7.25 KB       1 rows
. . exported "WMSYS"."WM$WORKSPACES_TABLE$"              5.937 KB       1 rows
. . exported "WMSYS"."WM$HINT_TABLE$"                    6.007 KB      97 rows
. . exported "LBACSYS"."OLS$INSTALLATIONS"               5.195 KB       2 rows
. . exported "WMSYS"."WM$WORKSPACE_PRIV_TABLE$"          5.195 KB      11 rows
. . exported "SYS"."DAM_CONFIG_PARAM$"                   5.117 KB      14 rows
. . exported "SYS"."TSDP_SUBPOL$"                        4.992 KB       1 rows
. . exported "WMSYS"."WM$NEXTVER_TABLE$"                 5.007 KB       1 rows
. . exported "LBACSYS"."OLS$PROPS"                       5.125 KB       5 rows
. . exported "WMSYS"."WM$ENV_VARS$"                      4.968 KB       3 rows
. . exported "SYS"."TSDP_PARAMETER$"                     4.921 KB       1 rows
. . exported "SYS"."TSDP_POLICY$"                        4.882 KB       1 rows
. . exported "WMSYS"."WM$VERSION_HIERARCHY_TABLE$"       4.945 KB       1 rows
. . exported "WMSYS"."WM$EVENTS_INFO$"                   4.960 KB      12 rows
. . exported "LBACSYS"."OLS$AUDIT_ACTIONS"               4.992 KB       8 rows
. . exported "LBACSYS"."OLS$DIP_EVENTS"                  4.859 KB       2 rows
. . exported "AUDSYS"."AUD$UNIFIED":"AUD_UNIFIED_P0"         0 KB       0 rows
. . exported "LBACSYS"."OLS$AUDIT"                           0 KB       0 rows
. . exported "LBACSYS"."OLS$COMPARTMENTS"                    0 KB       0 rows
. . exported "LBACSYS"."OLS$DIP_DEBUG"                       0 KB       0 rows
. . exported "LBACSYS"."OLS$GROUPS"                          0 KB       0 rows
. . exported "LBACSYS"."OLS$LAB"                             0 KB       0 rows
. . exported "LBACSYS"."OLS$LEVELS"                          0 KB       0 rows
. . exported "LBACSYS"."OLS$POL"                             0 KB       0 rows
. . exported "LBACSYS"."OLS$POLICY_ADMIN"                    0 KB       0 rows
. . exported "LBACSYS"."OLS$POLS"                            0 KB       0 rows
. . exported "LBACSYS"."OLS$POLT"                            0 KB       0 rows
. . exported "LBACSYS"."OLS$PROFILE"                         0 KB       0 rows
. . exported "LBACSYS"."OLS$PROFILES"                        0 KB       0 rows
. . exported "LBACSYS"."OLS$PROG"                            0 KB       0 rows
. . exported "LBACSYS"."OLS$SESSINFO"                        0 KB       0 rows
. . exported "LBACSYS"."OLS$USER"                            0 KB       0 rows
. . exported "LBACSYS"."OLS$USER_COMPARTMENTS"               0 KB       0 rows
. . exported "LBACSYS"."OLS$USER_GROUPS"                     0 KB       0 rows
. . exported "LBACSYS"."OLS$USER_LEVELS"                     0 KB       0 rows
. . exported "SYS"."AUD$"                                    0 KB       0 rows
. . exported "SYS"."DAM_CLEANUP_EVENTS$"                     0 KB       0 rows
. . exported "SYS"."DAM_CLEANUP_JOBS$"                       0 KB       0 rows
. . exported "SYS"."TSDP_ASSOCIATION$"                       0 KB       0 rows
. . exported "SYS"."TSDP_CONDITION$"                         0 KB       0 rows
. . exported "SYS"."TSDP_FEATURE_POLICY$"                    0 KB       0 rows
. . exported "SYS"."TSDP_PROTECTION$"                        0 KB       0 rows
. . exported "SYS"."TSDP_SENSITIVE_DATA$"                    0 KB       0 rows
. . exported "SYS"."TSDP_SENSITIVE_TYPE$"                    0 KB       0 rows
. . exported "SYS"."TSDP_SOURCE$"                            0 KB       0 rows
. . exported "SYSTEM"."REDO_LOG"                             0 KB       0 rows
. . exported "WMSYS"."WM$BATCH_COMPRESSIBLE_TABLES$"         0 KB       0 rows
. . exported "WMSYS"."WM$CONSTRAINTS_TABLE$"                 0 KB       0 rows
. . exported "WMSYS"."WM$CONS_COLUMNS$"                      0 KB       0 rows
. . exported "WMSYS"."WM$LOCKROWS_INFO$"                     0 KB       0 rows
. . exported "WMSYS"."WM$MODIFIED_TABLES$"                   0 KB       0 rows
. . exported "WMSYS"."WM$MP_GRAPH_WORKSPACES_TABLE$"         0 KB       0 rows
. . exported "WMSYS"."WM$MP_PARENT_WORKSPACES_TABLE$"        0 KB       0 rows
. . exported "WMSYS"."WM$NESTED_COLUMNS_TABLE$"              0 KB       0 rows
. . exported "WMSYS"."WM$RESOLVE_WORKSPACES_TABLE$"          0 KB       0 rows
. . exported "WMSYS"."WM$RIC_LOCKING_TABLE$"                 0 KB       0 rows
. . exported "WMSYS"."WM$RIC_TABLE$"                         0 KB       0 rows
. . exported "WMSYS"."WM$RIC_TRIGGERS_TABLE$"                0 KB       0 rows
. . exported "WMSYS"."WM$UDTRIG_DISPATCH_PROCS$"             0 KB       0 rows
. . exported "WMSYS"."WM$UDTRIG_INFO$"                       0 KB       0 rows
. . exported "WMSYS"."WM$VERSION_TABLE$"                     0 KB       0 rows
. . exported "WMSYS"."WM$VT_ERRORS_TABLE$"                   0 KB       0 rows
. . exported "WMSYS"."WM$WORKSPACE_SAVEPOINTS_TABLE$"        0 KB       0 rows
. . exported "MDSYS"."RDF_PARAM$"                        5.164 KB       3 rows
. . exported "SYS"."AUDTAB$TBS$FOR_EXPORT"               4.921 KB       2 rows
. . exported "SYS"."DBA_SENSITIVE_DATA"                      0 KB       0 rows
. . exported "SYS"."DBA_TSDP_POLICY_PROTECTION"              0 KB       0 rows
. . exported "SYS"."FGA_LOG$FOR_EXPORT"                      0 KB       0 rows
. . exported "SYS"."NACL$_ACE_EXP"                           0 KB       0 rows
. . exported "SYS"."NACL$_HOST_EXP"                      5.140 KB       1 rows
. . exported "SYS"."NACL$_WALLET_EXP"                        0 KB       0 rows
. . exported "SYS"."SQL$TEXT_DATAPUMP"                       0 KB       0 rows
. . exported "SYS"."SQL$_DATAPUMP"                           0 KB       0 rows
. . exported "SYS"."SQLOBJ$AUXDATA_DATAPUMP"                 0 KB       0 rows
. . exported "SYS"."SQLOBJ$DATA_DATAPUMP"                    0 KB       0 rows
. . exported "SYS"."SQLOBJ$PLAN_DATAPUMP"                    0 KB       0 rows
. . exported "SYS"."SQLOBJ$_DATAPUMP"                        0 KB       0 rows
. . exported "SYSTEM"."SCHEDULER_JOB_ARGS"                   0 KB       0 rows
. . exported "SYSTEM"."SCHEDULER_PROGRAM_ARGS"               0 KB       0 rows
. . exported "WMSYS"."WM$EXP_MAP"                        5.257 KB       3 rows
. . exported "WMSYS"."WM$METADATA_MAP"                       0 KB       0 rows
. . exported "ALPHA"."SALES_ORDER_HEADER"                130.8 KB   21456 rows
. . exported "ALPHA"."SALES_ORDER_LINE_ITEM"             70.98 KB   21456 rows
. . exported "ALPHA"."PRODUCTS"                          9.531 KB      57 rows
. . exported "ALPHA"."COUNTRY_CODES"                     8.242 KB     244 rows
. . exported "ALPHA"."ADDRESSES"                         9.117 KB     119 rows
. . exported "ALPHA"."CUSTOMERS"                         7.171 KB      16 rows
. . exported "ALPHA"."ORDERS"                            6.273 KB       3 rows
. . exported "ALPHA"."LOOKUP_CODES"                      6.726 KB      56 rows
. . exported "ALPHA"."PAYMENT_OPTIONS"                   6.257 KB       7 rows
. . exported "ALPHA"."ALPHA_SERVICES_STATS"              6.132 KB      33 rows
. . exported "ALPHA"."CUSTOMER_IDENTIFICATIONS"          6.031 KB       6 rows
. . exported "ALPHA"."ADDRESS_USAGES"                    5.781 KB      25 rows
. . exported "ALPHA"."PRODUCT_CATEGORIES"                5.953 KB      20 rows
. . exported "ALPHA"."DISCOUNTS"                         5.765 KB       7 rows
. . exported "ALPHA"."ORDER_ITEMS"                       5.625 KB       4 rows
. . exported "ALPHA"."COUPON_USAGES"                     5.539 KB       3 rows
. . exported "ALPHA"."PRODUCT_STOCK_LEVELS"              5.468 KB      26 rows
. . exported "ALPHA"."CUSTOMER_INTERESTS"                5.445 KB       6 rows
. . exported "ALPHA"."PRODUCT_IMAGES"                        0 KB       0 rows
. . exported "ALPHA_ARCHIVE"."ADDRESSES"                 9.085 KB     119 rows
. . exported "ALPHA_ARCHIVE"."ADDRESS_USAGES"            5.843 KB      25 rows
. . exported "ALPHA_ARCHIVE"."ALPHA_SERVICES_STATS"      6.164 KB      33 rows
. . exported "ALPHA_ARCHIVE"."COUNTRY_CODES"             8.242 KB     244 rows
. . exported "ALPHA_ARCHIVE"."COUPON_USAGES"             5.554 KB       3 rows
. . exported "ALPHA_ARCHIVE"."CUSTOMERS"                 7.195 KB      16 rows
. . exported "ALPHA_ARCHIVE"."CUSTOMER_IDENTIFICATIONS"  6.023 KB       6 rows
. . exported "ALPHA_ARCHIVE"."CUSTOMER_INTERESTS"        5.429 KB       6 rows
. . exported "ALPHA_ARCHIVE"."DISCOUNTS"                 5.812 KB       7 rows
. . exported "ALPHA_ARCHIVE"."LOOKUP_CODES"              6.718 KB      56 rows
. . exported "ALPHA_ARCHIVE"."ORDERS"                    6.265 KB       3 rows
. . exported "ALPHA_ARCHIVE"."ORDER_ITEMS"               5.648 KB       4 rows
. . exported "ALPHA_ARCHIVE"."PAYMENT_OPTIONS"           6.273 KB       7 rows
. . exported "ALPHA_ARCHIVE"."PRODUCTS"                  9.515 KB      57 rows
. . exported "ALPHA_ARCHIVE"."PRODUCT_CATEGORIES"        5.945 KB      20 rows
. . exported "ALPHA_ARCHIVE"."PRODUCT_IMAGES"                0 KB       0 rows
. . exported "ALPHA_ARCHIVE"."PRODUCT_STOCK_LEVELS"      5.468 KB      26 rows
. . exported "ALPHA_ARCHIVE"."SALES_ORDER_HEADER"        130.8 KB   21456 rows
. . exported "ALPHA_ARCHIVE"."SALES_ORDER_LINE_ITEM"     71.01 KB   21456 rows
Master table "SYSTEM"."SYS_EXPORT_FULL_01" successfully loaded/unloaded
******************************************************************************
Dump file set for SYSTEM.SYS_EXPORT_FULL_01 is:
  /tmp/source_pdb1.dmp
Job "SYSTEM"."SYS_EXPORT_FULL_01" successfully completed at Thu Jan 30 18:47:06 2020 elapsed 0 00:02:33
```

- Next we'll change the permissions so opc can scp the file to the target database.
```
<copy>chmod a+r /tmp/source_pdb1.dmp
exit -- from oracle</copy>
```

- Next scp (copy) the file to the target database with the opc user and then exit from the source database.
```
<copy>scp -i ~/id_rsa /tmp/source_pdb1.dmp opc@&lt;target db IP&gt;:/tmp</copy>
[opc@workshop1 ~]$ scp -i ~/id_rsa /tmp/source_pdb1.dmp opc@129.146.123.48:/tmp
source_pdb1.dmp                               100% 2024KB  96.6MB/s   00:00 
```

```
<copy>exit -- from opc source database</copy>
```

- SSH into the target database and chnage the permissions so the oracle user can read and import the file.
```
<copy>chmod a+r /tmp/source_pdb1.dmp</copy>
```

- Log in as oracle, and then log into sqlplus as the sys dba user.
```
<copy>sudo su - oracle

sqlplus sys/&lt;password&gt; as sysdba</copy>
SQL*Plus: Release 19.0.0.0.0 - Production on Thu Jan 30 20:02:15 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Connected to:
Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Version 19.5.0.0.0
```

- Now create a new target pluggable database pdb2 and then open the datbase.
```
<copy>create pluggable database pdb2 admin user alpha identified by &lt;password&gt;;</copy>
SQL> create pluggable database pdb2 admin user alpha identified by &lt;password&gt;;

Pluggable database created.
```

```
<copy>alter pluggable database pdb2 open;</copy>

Pluggable database altered.
```

- We need to open the encryption key for the new pdb2 database.
```
<copy>alter session set container=pdb2;
administer key management set key force keystore identified by &lt;password&gt; with backup;</copy>
keystore altered.
```

- Data pump requires that tablespaces are pre-created, or that you optionally remap source and target tablespaces if they are different.  We're create new ones with the same names as the source database.  We will use the system user to do that.
```
<copy>connect system/&lt;password&gt;@pdb2</copy>
Connected.
```

```
<copy>create tablespace alpha_archive datafile '+data';</copy>
Tablespace created.
```

```
<copy>create tablespace users datafile '+data';</copy>
Tablespace created.
```

- We will also pre-create the schemas.
```
<copy>create user alpha_archive identified by &lt;password&gt; default tablespace alpha_archive;</copy>
User created.
```

```
<copy>grant dba to alpha_archive;<c/opy>
Grant succeeded.
```

```
<copy>grant dba to alpha;</copy>
Grant succeeded.
```

```
<copy>alter user alpha default tablespace users;</copy>
User altered.
```

- Since this is a new database we also need to create an oracle directory that is used in the data pump import.
```
<copy>create directory tmp as '/tmp';</copy>
Directory created.
```

```
<copy>exit -- from sqlplus</copy>
```

- We also need to create a new entry in the tnsnames.ora file for the new pdb.  Use the vi/vim/nano editor to do that.  Create the pdb2 entry noted below using your particular service name.  you can copy the existing pdb1 entry and modify the name and service name.
```
<copy>vi /u01/app/oracle/product/19.0.0.0/dbhome_1/network/admin/tnsnames.ora</copy>

pdb1 =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = workshop1-2)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = pdb1.sub01092328510.vcn1.oraclevcn.com)
    )
  )

pdb2 =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = workshop1-2)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = pdb2.sub01092328510.vcn1.oraclevcn.com)
    )
  )
```

- After saving the changes to the tnsnames.ora file run the data pump import command.  You will need to supply the password you gave when you exported the data.
```
<copy>impdp alpha/&lt;password&gt;@pdb2 dumpfile=source_pdb1.dmp logfile=source_pdb1.log directory=tmp full=y encryption_password=&lt;password&gt;</copy>

[oracle@workshop1-2 ~]$ impdp alpha/&lt;password&gt;@pdb2 dumpfile=source_pdb1.dmp logfile=source_pdb1.log directory=tmp full=y encryption_password=&lt;password&gt;

Import: Release 19.0.0.0.0 - Production on Thu Jan 30 22:45:44 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

Connected to: Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Master table "ALPHA"."SYS_IMPORT_FULL_01" successfully loaded/unloaded
Starting "ALPHA"."SYS_IMPORT_FULL_01":  alpha/********@pdb2 dumpfile=source_pdb1.dmp logfile=source_pdb1.log directory=tmp full=y encryption_password=******** 
Processing object type DATABASE_EXPORT/PRE_SYSTEM_IMPCALLOUT/MARKER
Processing object type DATABASE_EXPORT/PRE_INSTANCE_IMPCALLOUT/MARKER
Processing object type DATABASE_EXPORT/TABLESPACE
ORA-31684: Object type TABLESPACE:"UNDOTBS1" already exists

ORA-31684: Object type TABLESPACE:"TEMP" already exists

ORA-31684: Object type TABLESPACE:"USERS" already exists

ORA-31684: Object type TABLESPACE:"ALPHA_ARCHIVE" already exists

Processing object type DATABASE_EXPORT/PROFILE
Processing object type DATABASE_EXPORT/SCHEMA/USER
ORA-31684: Object type USER:"ALPHA" already exists

ORA-31684: Object type USER:"ALPHA_ARCHIVE" already exists

Processing object type DATABASE_EXPORT/RADM_FPTM
Processing object type DATABASE_EXPORT/GRANT/SYSTEM_GRANT/PROC_SYSTEM_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/GRANT/SYSTEM_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/ROLE_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/DEFAULT_ROLE
Processing object type DATABASE_EXPORT/SCHEMA/ON_USER_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/TABLESPACE_QUOTA
Processing object type DATABASE_EXPORT/RESOURCE_COST
Processing object type DATABASE_EXPORT/TRUSTED_DB_LINK
Processing object type DATABASE_EXPORT/SCHEMA/SEQUENCE/SEQUENCE
Processing object type DATABASE_EXPORT/DIRECTORY/DIRECTORY
ORA-31684: Object type DIRECTORY:"TMP" already exists

Processing object type DATABASE_EXPORT/DIRECTORY/GRANT/OWNER_GRANT/OBJECT_GRANT
Processing object type DATABASE_EXPORT/SYSTEM_PROCOBJACT/PRE_SYSTEM_ACTIONS/PROCACT_SYSTEM
>>> Cannot set an SCN larger than the current SCN. If a Streams Capture configuration was imported then the Apply that processes the captured messages needs to be dropped and recreated. See My Oracle Support article number 1380295.1.
Processing object type DATABASE_EXPORT/SYSTEM_PROCOBJACT/PROCOBJ
Processing object type DATABASE_EXPORT/SYSTEM_PROCOBJACT/POST_SYSTEM_ACTIONS/PROCACT_SYSTEM
Processing object type DATABASE_EXPORT/SCHEMA/PROCACT_SCHEMA
Processing object type DATABASE_EXPORT/EARLY_OPTIONS/VIEWS_AS_TABLES/TABLE
Processing object type DATABASE_EXPORT/EARLY_OPTIONS/VIEWS_AS_TABLES/TABLE_DATA
. . imported "SYS"."KU$_EXPORT_USER_MAP"                 5.273 KB      38 rows
Processing object type DATABASE_EXPORT/EARLY_POST_INSTANCE_IMPCALLOUT/MARKER
Processing object type DATABASE_EXPORT/NORMAL_OPTIONS/TABLE
Processing object type DATABASE_EXPORT/NORMAL_OPTIONS/TABLE_DATA
. . imported "AUDSYS"."AMGT$DP$AUD$UNIFIED":"SYS_P201"   197.0 KB    2848 rows
. . imported "AUDSYS"."AMGT$DP$AUD$UNIFIED":"SYS_P261"   63.51 KB     398 rows
. . imported "SYSTEM"."REDO_DB_TMP"                       7.25 KB       1 rows
. . imported "WMSYS"."E$WORKSPACES_TABLE$"               5.937 KB       1 rows
. . imported "WMSYS"."E$HINT_TABLE$"                     6.007 KB      97 rows
. . imported "WMSYS"."E$WORKSPACE_PRIV_TABLE$"           5.195 KB      11 rows
. . imported "SYS"."AMGT$DP$DAM_CONFIG_PARAM$"           5.117 KB      14 rows
. . imported "SYS"."DP$TSDP_SUBPOL$"                     4.992 KB       1 rows
. . imported "WMSYS"."E$NEXTVER_TABLE$"                  5.007 KB       1 rows
. . imported "WMSYS"."E$ENV_VARS$"                       4.968 KB       3 rows
. . imported "SYS"."DP$TSDP_PARAMETER$"                  4.921 KB       1 rows
. . imported "SYS"."DP$TSDP_POLICY$"                     4.882 KB       1 rows
. . imported "WMSYS"."E$VERSION_HIERARCHY_TABLE$"        4.945 KB       1 rows
. . imported "WMSYS"."E$EVENTS_INFO$"                    4.960 KB      12 rows
. . imported "AUDSYS"."AMGT$DP$AUD$UNIFIED":"AUD_UNIFIED_P0"      0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$AUDIT"                    0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$COMPARTMENTS"             0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$GROUPS"                   0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$LAB"                      0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$LEVELS"                   0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$POL"                      0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$POLS"                     0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$POLT"                     0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$PROFILE"                  0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$PROG"                     0 KB       0 rows
. . imported "LBACSYS"."OLS_DP$OLS$USER"                     0 KB       0 rows
. . imported "SYS"."AMGT$DP$AUD$"                            0 KB       0 rows
. . imported "SYS"."AMGT$DP$DAM_CLEANUP_EVENTS$"             0 KB       0 rows
. . imported "SYS"."AMGT$DP$DAM_CLEANUP_JOBS$"               0 KB       0 rows
. . imported "SYS"."DP$TSDP_ASSOCIATION$"                    0 KB       0 rows
. . imported "SYS"."DP$TSDP_CONDITION$"                      0 KB       0 rows
. . imported "SYS"."DP$TSDP_FEATURE_POLICY$"                 0 KB       0 rows
. . imported "SYS"."DP$TSDP_PROTECTION$"                     0 KB       0 rows
. . imported "SYS"."DP$TSDP_SENSITIVE_DATA$"                 0 KB       0 rows
. . imported "SYS"."DP$TSDP_SENSITIVE_TYPE$"                 0 KB       0 rows
. . imported "SYS"."DP$TSDP_SOURCE$"                         0 KB       0 rows
. . imported "SYSTEM"."REDO_LOG_TMP"                         0 KB       0 rows
. . imported "WMSYS"."E$BATCH_COMPRESSIBLE_TABLES$"          0 KB       0 rows
. . imported "WMSYS"."E$CONSTRAINTS_TABLE$"                  0 KB       0 rows
. . imported "WMSYS"."E$CONS_COLUMNS$"                       0 KB       0 rows
. . imported "WMSYS"."E$LOCKROWS_INFO$"                      0 KB       0 rows
. . imported "WMSYS"."E$MODIFIED_TABLES$"                    0 KB       0 rows
. . imported "WMSYS"."E$MP_GRAPH_WORKSPACES_TABLE$"          0 KB       0 rows
. . imported "WMSYS"."E$MP_PARENT_WORKSPACES_TABLE$"         0 KB       0 rows
. . imported "WMSYS"."E$NESTED_COLUMNS_TABLE$"               0 KB       0 rows
. . imported "WMSYS"."E$RESOLVE_WORKSPACES_TABLE$"           0 KB       0 rows
. . imported "WMSYS"."E$RIC_LOCKING_TABLE$"                  0 KB       0 rows
. . imported "WMSYS"."E$RIC_TABLE$"                          0 KB       0 rows
. . imported "WMSYS"."E$RIC_TRIGGERS_TABLE$"                 0 KB       0 rows
. . imported "WMSYS"."E$UDTRIG_DISPATCH_PROCS$"              0 KB       0 rows
. . imported "WMSYS"."E$UDTRIG_INFO$"                        0 KB       0 rows
. . imported "WMSYS"."E$VERSION_TABLE$"                      0 KB       0 rows
. . imported "WMSYS"."E$VT_ERRORS_TABLE$"                    0 KB       0 rows
. . imported "WMSYS"."E$WORKSPACE_SAVEPOINTS_TABLE$"         0 KB       0 rows
Processing object type DATABASE_EXPORT/NORMAL_OPTIONS/VIEWS_AS_TABLES/TABLE
Processing object type DATABASE_EXPORT/NORMAL_OPTIONS/VIEWS_AS_TABLES/TABLE_DATA
. . imported "MDSYS"."RDF_PARAM$TBL"                     5.164 KB       3 rows
. . imported "SYS"."AMGT$DP$AUDTAB$TBS$FOR_EXPORT"       4.921 KB       2 rows
. . imported "SYS"."DP$DBA_SENSITIVE_DATA"                   0 KB       0 rows
. . imported "SYS"."DP$DBA_TSDP_POLICY_PROTECTION"           0 KB       0 rows
. . imported "SYS"."AMGT$DP$FGA_LOG$FOR_EXPORT"              0 KB       0 rows
. . imported "SYS"."NACL$_ACE_IMP"                           0 KB       0 rows
. . imported "SYS"."NACL$_HOST_IMP"                      5.140 KB       1 rows
. . imported "SYS"."NACL$_WALLET_IMP"                        0 KB       0 rows
. . imported "SYS"."DATAPUMP$SQL$TEXT"                       0 KB       0 rows
. . imported "SYS"."DATAPUMP$SQL$"                           0 KB       0 rows
. . imported "SYS"."DATAPUMP$SQLOBJ$AUXDATA"                 0 KB       0 rows
. . imported "SYS"."DATAPUMP$SQLOBJ$DATA"                    0 KB       0 rows
. . imported "SYS"."DATAPUMP$SQLOBJ$PLAN"                    0 KB       0 rows
. . imported "SYS"."DATAPUMP$SQLOBJ$"                        0 KB       0 rows
. . imported "SYSTEM"."SCHEDULER_JOB_ARGS_TMP"               0 KB       0 rows
. . imported "SYSTEM"."SCHEDULER_PROGRAM_ARGS_TMP"           0 KB       0 rows
. . imported "WMSYS"."E$EXP_MAP"                         5.257 KB       3 rows
. . imported "WMSYS"."E$METADATA_MAP"                        0 KB       0 rows
Processing object type DATABASE_EXPORT/NORMAL_POST_INSTANCE_IMPCALLOUT/MARKER
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/TABLE
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/TABLE_DATA
. . imported "ALPHA"."SALES_ORDER_HEADER"                130.8 KB   21456 rows
. . imported "ALPHA_ARCHIVE"."SALES_ORDER_HEADER"        130.8 KB   21456 rows
. . imported "ALPHA"."SALES_ORDER_LINE_ITEM"             70.98 KB   21456 rows
. . imported "ALPHA_ARCHIVE"."SALES_ORDER_LINE_ITEM"     71.01 KB   21456 rows
. . imported "ALPHA"."PRODUCTS"                          9.531 KB      57 rows
. . imported "ALPHA_ARCHIVE"."PRODUCTS"                  9.515 KB      57 rows
. . imported "ALPHA"."COUNTRY_CODES"                     8.242 KB     244 rows
. . imported "ALPHA_ARCHIVE"."COUNTRY_CODES"             8.242 KB     244 rows
. . imported "ALPHA"."ADDRESSES"                         9.117 KB     119 rows
. . imported "ALPHA_ARCHIVE"."ADDRESSES"                 9.085 KB     119 rows
. . imported "ALPHA"."CUSTOMERS"                         7.171 KB      16 rows
. . imported "ALPHA_ARCHIVE"."CUSTOMERS"                 7.195 KB      16 rows
. . imported "ALPHA"."ORDERS"                            6.273 KB       3 rows
. . imported "ALPHA_ARCHIVE"."ORDERS"                    6.265 KB       3 rows
. . imported "ALPHA"."LOOKUP_CODES"                      6.726 KB      56 rows
. . imported "ALPHA_ARCHIVE"."LOOKUP_CODES"              6.718 KB      56 rows
. . imported "ALPHA"."PAYMENT_OPTIONS"                   6.257 KB       7 rows
. . imported "ALPHA_ARCHIVE"."PAYMENT_OPTIONS"           6.273 KB       7 rows
. . imported "ALPHA"."ALPHA_SERVICES_STATS"              6.132 KB      33 rows
. . imported "ALPHA_ARCHIVE"."ALPHA_SERVICES_STATS"      6.164 KB      33 rows
. . imported "ALPHA"."CUSTOMER_IDENTIFICATIONS"          6.031 KB       6 rows
. . imported "ALPHA_ARCHIVE"."CUSTOMER_IDENTIFICATIONS"  6.023 KB       6 rows
. . imported "ALPHA"."ADDRESS_USAGES"                    5.781 KB      25 rows
. . imported "ALPHA_ARCHIVE"."ADDRESS_USAGES"            5.843 KB      25 rows
. . imported "ALPHA"."PRODUCT_CATEGORIES"                5.953 KB      20 rows
. . imported "ALPHA_ARCHIVE"."PRODUCT_CATEGORIES"        5.945 KB      20 rows
. . imported "ALPHA"."DISCOUNTS"                         5.765 KB       7 rows
. . imported "ALPHA_ARCHIVE"."DISCOUNTS"                 5.812 KB       7 rows
. . imported "ALPHA"."ORDER_ITEMS"                       5.625 KB       4 rows
. . imported "ALPHA_ARCHIVE"."ORDER_ITEMS"               5.648 KB       4 rows
. . imported "ALPHA"."COUPON_USAGES"                     5.539 KB       3 rows
. . imported "ALPHA_ARCHIVE"."COUPON_USAGES"             5.554 KB       3 rows
. . imported "ALPHA"."PRODUCT_STOCK_LEVELS"              5.468 KB      26 rows
. . imported "ALPHA_ARCHIVE"."PRODUCT_STOCK_LEVELS"      5.468 KB      26 rows
. . imported "ALPHA"."CUSTOMER_INTERESTS"                5.445 KB       6 rows
. . imported "ALPHA_ARCHIVE"."CUSTOMER_INTERESTS"        5.429 KB       6 rows
. . imported "ALPHA"."PRODUCT_IMAGES"                        0 KB       0 rows
. . imported "ALPHA_ARCHIVE"."PRODUCT_IMAGES"                0 KB       0 rows
Processing object type DATABASE_EXPORT/SCHEMA/FUNCTION/FUNCTION
Processing object type DATABASE_EXPORT/SCHEMA/PROCEDURE/PROCEDURE
Processing object type DATABASE_EXPORT/SCHEMA/FUNCTION/ALTER_FUNCTION
Processing object type DATABASE_EXPORT/SCHEMA/PROCEDURE/ALTER_PROCEDURE
Processing object type DATABASE_EXPORT/SCHEMA/VIEW/VIEW
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/INDEX/INDEX
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/CONSTRAINT/CONSTRAINT
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/INDEX/STATISTICS/INDEX_STATISTICS
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/CONSTRAINT/REF_CONSTRAINT
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/STATISTICS/TABLE_STATISTICS
Processing object type DATABASE_EXPORT/STATISTICS/MARKER
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/TRIGGER
Processing object type DATABASE_EXPORT/FINAL_POST_INSTANCE_IMPCALLOUT/MARKER
Processing object type DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCACT_SCHEMA
Processing object type DATABASE_EXPORT/SCHEMA/PASSWORD_HISTORY
ORA-39111: Dependent object type PASSWORD_HISTORY:"ALPHA" skipped, base object type USER:"ALPHA" already exists

ORA-39111: Dependent object type PASSWORD_HISTORY:"ALPHA_ARCHIVE" skipped, base object type USER:"ALPHA_ARCHIVE" already exists

Processing object type DATABASE_EXPORT/AUDIT_UNIFIED/AUDIT_POLICY_ENABLE
Processing object type DATABASE_EXPORT/POST_SYSTEM_IMPCALLOUT/MARKER
ORA-39082: Object type FUNCTION:"ALPHA"."CALCTPS" created with compilation warnings

Job "ALPHA"."SYS_IMPORT_FULL_01" completed with 10 error(s) at Thu Jan 30 22:48:12 2020 elapsed 0 00:02:22
```

- Log into user alpha in pdb2 and confirm the data is there.
```
<copy>sqlplus alpha/&lt;password&gt;@pdb2</copy>

SQL*Plus: Release 19.0.0.0.0 - Production on Fri Jan 31 16:26:01 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Last Successful login time: Thu Jan 30 2020 22:45:44 +00:00

Connected to:
Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Version 19.5.0.0.0
```

```
<copy>elect table_name from user_tables;</copy>

TABLE_NAME
----------------------------------------------
ORDERS
CUSTOMERS
LOOKUP_CODES
ALPHA_SERVICES_STATS
PRODUCT_CATEGORIES
PRODUCTS
SALES_ORDER_LINE_ITEM
COUNTRY_CODES
ADDRESSES
PAYMENT_OPTIONS
CUSTOMER_IDENTIFICATIONS
SALES_ORDER_HEADER
DISCOUNTS
CUSTOMER_INTERESTS
ADDRESS_USAGES
PRODUCT_STOCK_LEVELS
ORDER_ITEMS
COUPON_USAGES
PRODUCT_IMAGES

19 rows selected.
```

## Task 3:  Copy data across databases using database links.

Database links are a very convenient way of referencing remote objects as though they were local.  In fact database links can even query remote non-Oracle databases (heterogeneous services), but that is beyond the scope of this lab.  In this lab we will copy data from the source database to the target database.

- SSH into the target database and set global names to false.  The database will need to restarted.
```
<copy>sudo su - oracle</copy>
Last login: Fri Jan 31 17:07:58 UTC 2020
```

```
<copy>sqlplus sys/&lt;password&gt; as sysdba</copy>

SQL*Plus: Release 19.0.0.0.0 - Production on Fri Jan 31 17:10:20 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Connected to:
Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Version 19.5.0.0.0
```

```
<copy>alter system set global_names= false scope=spfile;</copy>

System altered.
```

```
<copy>shutdown immediate;</copy>
Database closed.
Database dismounted.
ORACLE instance shut down.
```

```
<copy>startup</copy>
ORACLE instance started.

Total System Global Area 1.6106E+10 bytes
Fixed Size		    9154008 bytes
Variable Size		 2315255808 bytes
Database Buffers	 1.3757E+10 bytes
Redo Buffers		   24399872 bytes
Database mounted.
Database opened.
SQL> 
```

- Connect to pdb2 using the alpha userid and create a new database link to pdb1 in the source database.  You can name the link anything you want, but if you need to connect back to the cdb to remote clone a pdb the the db link name must be the service name of the remote cdb.  We'll use the service name of the remote pdb so it's clear what db we're connecting to.
```
<copy>connect alpha/&lt;password&gt;@pdb2

create database link pdb1.sub01092328510.vcn1.oraclevcn.com
connect to alpha identified by &lt;password&gt;
using '(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=workshop1-scan)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pdb1.sub01092328510.vcn1.oraclevcn.com)))'; </copy>

Database link created.
```

```
<copy>select sysdate from dual@pdb1.sub01092328510.vcn1.oraclevcn.com;</copy>

SYSDATE
---------
31-JAN-20
```

- Now we can copy data from the source to the target.  First see what tables are in the remote database.  Of course they're the same tables we have been working with throughout these labs.
```
<copy>select table_name from user_tables@pdb1.sub01092328510.vcn1.oraclevcn.com;</copy>

TABLE_NAME
---------------------------------------------
ADDRESSES
ADDRESS_USAGES
ALPHA_SERVICES_STATS
COUNTRY_CODES
COUPON_USAGES
CUSTOMERS
CUSTOMER_IDENTIFICATIONS
CUSTOMER_INTERESTS
DISCOUNTS
LOOKUP_CODES
ORDERS
ORDER_ITEMS
PAYMENT_OPTIONS
PRODUCTS
PRODUCT_CATEGORIES
PRODUCT_STOCK_LEVELS
SALES_ORDER_HEADER
SALES_ORDER_LINE_ITEM
PRODUCT_IMAGES
```

- Now lets create a copy of one of these tables.  We'll be copying ORDER\_ITEMS from the remote (source) pdb1 database to the local target order\_items_copy (new table).  Since we're creating a new table the link supports both DDL and DML operations.
```
<copy>create table order_items_copy as select * from order_items@pdb1.sub01092328510.vcn1.oraclevcn.com;</copy>
SQL> create table order_items_copy as select * from order_items@pdb1.sub01092328510.vcn1.oraclevcn.com;

Table created.
```

***

This completes Lab 3.  You can proceed to Lab 4.
